pigz: not found
>>> esh: Building main/esh 0.3.2-r0 (using abuild 3.14.1-r4) started Fri, 23 May 2025 18:12:50 +0000
>>> esh: Validating /home/packager/aports/main/esh/APKBUILD...
>>> esh: Analyzing dependencies...
>>> esh: Installing for build: build-base asciidoctor
(1/7) Installing ca-certificates (20241121-r2)
(2/7) Installing libffi (3.4.7-r0)
(3/7) Installing yaml (0.2.5-r2)
(4/7) Installing ruby-libs (3.3.8-r0)
(5/7) Installing ruby (3.3.8-r0)
(6/7) Installing asciidoctor (2.0.23-r1)
(7/7) Installing .makedepends-esh (20250523.181254)
Executing ca-certificates-20241121-r2.trigger
Executing busybox-1.37.0-r12.trigger
OK: 582 MiB in 139 packages
>>> esh: Cleaning up srcdir
>>> esh: Cleaning up pkgdir
>>> esh: Cleaning up tmpdir
>>> esh: Fetching https://github.com/jirutka/esh/archive/v0.3.2/esh-0.3.2.tar.gz
Connecting to github.com (140.82.121.4:443)
Connecting to codeload.github.com (140.82.121.10:443)
saving to '/var/cache/distfiles/esh-0.3.2.tar.gz.part'
esh-0.3.2.tar.gz.par 100% |********************************| 13105  0:00:00 ETA
'/var/cache/distfiles/esh-0.3.2.tar.gz.part' saved
>>> esh: Fetching https://github.com/jirutka/esh/archive/v0.3.2/esh-0.3.2.tar.gz
>>> esh: Checking sha512sums...
esh-0.3.2.tar.gz: OK
>>> esh: Unpacking /var/cache/distfiles/esh-0.3.2.tar.gz...
test-cli-dump................... OK
test-cli-help................... OK
test-cli-illegal-argument....... OK
test-cli-no-args................ OK
test-cli-read-from-stdin........ OK
test-cli-unknown-option......... FAIL
test-comments................... OK
test-empty-file................. OK
test-empty-lines................ OK
test-escaped-tags............... OK
test-eval-error-nested.......... FAIL
test-eval-error................. FAIL
test-include-max-depth.......... OK
test-include-no-closing......... OK
test-include-not-found-nested... OK
test-include-not-found.......... OK
test-include-recursive.......... OK
test-include-trim-newline....... OK
test-include.................... OK
test-multiline-tags............. OK
test-print-tag.................. OK
test-scriplet-tag............... OK
test-text-escaping.............. OK
test-trim-newline............... OK

========================================================================
FAILED: test-cli-unknown-option
-------------------------------- stdout --------------------------------

-------------------------------- stderr --------------------------------
--- test-cli-unknown-option.exp2
+++ test-cli-unknown-option.err2
@@ -1,2 +1,4 @@
-esh: unknown option: -x
-%exit-status: 10
+  		'?') echo "$PROGNAME: unknown option: -$OPTARG" >&2; exit 10;;
+  		                                       ^~~~~~~
+../esh:326: fatal: Undefined variable 'OPTARG'
+%exit-status: 1

========================================================================

========================================================================
FAILED: test-eval-error-nested
-------------------------------- stdout --------------------------------
Content from the file incl/b.esh:
This is file incl/b.esh.

Content from the file a.esh follows:
This is file incl/a.esh.
Variable var1=42

End of file incl/b.esh.
The main file continues.

Now try to include file with an invalid shell command:
This is file incl/eval-error.esh.

Let's try a non-existing command: 
-------------------------------- stderr --------------------------------
--- test-eval-error-nested.exp2
+++ test-eval-error-nested.err2
@@ -1,4 +1,4 @@
-incl/eval-error.esh:3:  set -eu; does-not-exist-666
-           ^~~~~~~~~~~~~~~~~~
-1: Command 'does-not-exist-666' not found (OILS-ERR-100)
+   does-not-exist-666
+   ^~~~~~~~~~~~~~~~~~
+incl/eval-error.esh:3: Command 'does-not-exist-666' not found (OILS-ERR-100)
 %exit-status: 127

========================================================================

========================================================================
FAILED: test-eval-error
-------------------------------- stdout --------------------------------
Lorem ipsum dolor sit amet,
consectetur adipiscing elit.

Let's try an undefined variable: 
-------------------------------- stderr --------------------------------
--- test-eval-error.exp2
+++ test-eval-error.err2
@@ -1,4 +1,4 @@
-test-eval-error.in:4:  set -eu; echo $undefined_var
-                ^~~~~~~~~~~~~~
- fatal: Undefined variable 'undefined_var'
+  __print  $undefined_var
+           ^~~~~~~~~~~~~~
+test-eval-error.in:4: fatal: Undefined variable 'undefined_var'
 %exit-status: 1

========================================================================

FAILED 3/24
make: *** [Makefile:62: test] Error 1
>>> ERROR: esh: check failed
>>> esh: Uninstalling dependencies...
(1/7) Purging .makedepends-esh (20250523.181254)
(2/7) Purging asciidoctor (2.0.23-r1)
(3/7) Purging ruby (3.3.8-r0)
(4/7) Purging ca-certificates (20241121-r2)
Executing ca-certificates-20241121-r2.post-deinstall
(5/7) Purging ruby-libs (3.3.8-r0)
(6/7) Purging yaml (0.2.5-r2)
(7/7) Purging libffi (3.4.7-r0)
Executing busybox-1.37.0-r12.trigger
OK: 564 MiB in 132 packages
