pigz: not found
>>> lua-aports: Building main/lua-aports 1.2.1-r1 (using abuild 3.14.1-r4) started Fri, 23 May 2025 19:07:31 +0000
>>> lua-aports: Validating /home/packager/aports/main/lua-aports/APKBUILD...
>>> lua-aports: Analyzing dependencies...
>>> lua-aports: Installing for build: build-base abuild lua5.4-cjson lua5.4-filesystem lua5.4-optarg lua5.4 lua5.4-penlight lua5.4-busted lua5.4-posix
(1/13) Installing lua-filesystem (1.8.0-r4)
(2/13) Installing lua-penlight (1.14.0-r0)
(3/13) Installing lua5.4-penlight (1.14.0-r0)
(4/13) Installing lua-cliargs (3.0.2-r0)
(5/13) Installing lua5.4-say (1.4.1-r0)
(6/13) Installing lua5.4-luassert (1.9.0-r0)
(7/13) Installing lua5.4-mediator (1.1.2-r2)
(8/13) Installing lua5.4-system (0.4.5-r0)
(9/13) Installing lua5.4-term (0.07-r2)
(10/13) Installing lua5.4-busted (2.2.0-r0)
(11/13) Installing lua5.4-bit32 (5.3.0-r6)
(12/13) Installing lua5.4-posix (36.3-r0)
(13/13) Installing .makedepends-lua-aports (20250523.190733)
Executing busybox-1.37.0-r12.trigger
OK: 566 MiB in 145 packages
>>> lua-aports: Cleaning up srcdir
>>> lua-aports: Cleaning up pkgdir
>>> lua-aports: Cleaning up tmpdir
>>> lua-aports: Fetching lua-aports-1.2.1.tar.gz::https://gitlab.alpinelinux.org/alpine/lua-aports/-/archive/1.2.1/lua-aports-1.2.1.tar.gz
Connecting to gitlab.alpinelinux.org (172.105.69.85:443)
saving to '/var/cache/distfiles/lua-aports-1.2.1.tar.gz.part'
lua-aports-1.2.1.tar 100% |********************************| 11940  0:00:00 ETA
'/var/cache/distfiles/lua-aports-1.2.1.tar.gz.part' saved
>>> lua-aports: Fetching lua-aports-1.2.1.tar.gz::https://gitlab.alpinelinux.org/alpine/lua-aports/-/archive/1.2.1/lua-aports-1.2.1.tar.gz
>>> lua-aports: Checking sha512sums...
lua-aports-1.2.1.tar.gz: OK
>>> lua-aports: Unpacking /var/cache/distfiles/lua-aports-1.2.1.tar.gz...
[==========] Running tests from scanned files.
[----------] Global test environment setup.
[----------] Running tests from spec/abuild_spec.lua
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
[ RUN      ] spec/abuild_spec.lua:36: abuild get_conf should return the value of a configuration variable from the user config
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/abuild_spec.lua:37: Expected objects to be equal.
Passed in:
(string) ''
Expected:
(string) 'myvalue'

stack traceback:
	spec/abuild_spec.lua:37: in function <spec/abuild_spec.lua:36>

[  FAILED  ] spec/abuild_spec.lua:36: abuild get_conf should return the value of a configuration variable from the user config (81.74 ms)
[ RUN      ] spec/abuild_spec.lua:43: abuild get_arch should return the CARCH value from the environment
[       OK ] spec/abuild_spec.lua:43: abuild get_arch should return the CARCH value from the environment (0.13 ms)
[ RUN      ] spec/abuild_spec.lua:49: abuild get_arch should return the CARCH value from user config
spec/abuild_spec.lua:50: Expected objects to be equal.
Passed in:
(string) ''
Expected:
(string) 'aarch64'

stack traceback:
	spec/abuild_spec.lua:50: in function <spec/abuild_spec.lua:49>

[  FAILED  ] spec/abuild_spec.lua:49: abuild get_arch should return the CARCH value from user config (3.68 ms)
[ RUN      ] spec/abuild_spec.lua:57: abuild get_libc should return the libc value from the user config
spec/abuild_spec.lua:58: Expected objects to be equal.
Passed in:
(string) ''
Expected:
(string) 'musl'

stack traceback:
	spec/abuild_spec.lua:58: in function <spec/abuild_spec.lua:57>

[  FAILED  ] spec/abuild_spec.lua:57: abuild get_libc should return the libc value from the user config (3.80 ms)
[ RUN      ] spec/abuild_spec.lua:65: abuild abuild.repodest should contain the REPODEST value from the user config
spec/abuild_spec.lua:66: Expected objects to be equal.
Passed in:
(string) ''
Expected:
(string) '/tmp/lua_NMkljh'

stack traceback:
	spec/abuild_spec.lua:66: in function <spec/abuild_spec.lua:65>

[  FAILED  ] spec/abuild_spec.lua:65: abuild abuild.repodest should contain the REPODEST value from the user config (3.59 ms)
[ RUN      ] spec/abuild_spec.lua:72: abuild abuild.chost should contain the CHOST value from the user config
spec/abuild_spec.lua:73: Expected objects to be equal.
Passed in:
(string) ''
Expected:
(string) 'aarch64-alpine-linux-musl'

stack traceback:
	spec/abuild_spec.lua:73: in function <spec/abuild_spec.lua:72>

[  FAILED  ] spec/abuild_spec.lua:72: abuild abuild.chost should contain the CHOST value from the user config (3.79 ms)
[----------] 6 tests from spec/abuild_spec.lua (475.36 ms total)

[----------] Running tests from spec/db_spec.lua
[ RUN      ] spec/db_spec.lua:66: db new should initialize the APK database correctly
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:74: Expected objects to not be the same.
Passed in:
(nil)
Did not expect:
type nil

stack traceback:
	spec/db_spec.lua:74: in function <spec/db_spec.lua:66>

[  FAILED  ] spec/db_spec.lua:66: db new should initialize the APK database correctly (358.79 ms)
[ RUN      ] spec/db_spec.lua:81: db target_packages should list all target packages
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:86: Expected objects to not be the same.
Passed in:
(nil)
Did not expect:
type nil

stack traceback:
	spec/db_spec.lua:86: in function <spec/db_spec.lua:81>

[  FAILED  ] spec/db_spec.lua:81: db target_packages should list all target packages (72.86 ms)
[ RUN      ] spec/db_spec.lua:96: db recursive_dependencies should list all dependencies in correct order
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:108: Expected objects to not be the same.
Passed in:
(nil)
Did not expect:
type nil

stack traceback:
	spec/db_spec.lua:108: in function <spec/db_spec.lua:96>

[  FAILED  ] spec/db_spec.lua:96: db recursive_dependencies should list all dependencies in correct order (57.96 ms)
[ RUN      ] spec/db_spec.lua:118: db recursive_reverse_dependencies should list all reverse dependencies in correct order
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:127: Expected objects to not be the same.
Passed in:
(nil)
Did not expect:
type nil

stack traceback:
	spec/db_spec.lua:127: in function <spec/db_spec.lua:118>

[  FAILED  ] spec/db_spec.lua:118: db recursive_reverse_dependencies should list all reverse dependencies in correct order (67.72 ms)
[ RUN      ] spec/db_spec.lua:137: db each_name should list all apk names and its origin
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:145: Expected objects to not be the same.
Passed in:
(nil)
Did not expect:
type nil

stack traceback:
	spec/db_spec.lua:145: in function <spec/db_spec.lua:137>

[  FAILED  ] spec/db_spec.lua:137: db each_name should list all apk names and its origin (92.00 ms)
[ RUN      ] spec/db_spec.lua:155: db each_known_dependency should list all known dependencies
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:164: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:164: in function <spec/db_spec.lua:155>

[  ERROR   ] spec/db_spec.lua:155: db each_known_dependency should list all known dependencies (74.90 ms)
[ RUN      ] spec/db_spec.lua:169: db each_known_dependency should list a provides as a known dependencies
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:178: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:178: in function <spec/db_spec.lua:169>

[  ERROR   ] spec/db_spec.lua:169: db each_known_dependency should list a provides as a known dependencies (76.87 ms)
[ RUN      ] spec/db_spec.lua:186: db each_aport should list all apk names and its origin
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:195: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:195: in function <spec/db_spec.lua:186>

[  ERROR   ] spec/db_spec.lua:186: db each_aport should list all apk names and its origin (61.29 ms)
[ RUN      ] spec/db_spec.lua:203: db each_pkg_with_name should only list the origin(s) for the given package names
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:213: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:213: in function <spec/db_spec.lua:203>

[  ERROR   ] spec/db_spec.lua:203: db each_pkg_with_name should only list the origin(s) for the given package names (67.04 ms)
[ RUN      ] spec/db_spec.lua:221: db each_provider_for should list the providing origins for the given package names
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:231: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:231: in function <spec/db_spec.lua:221>

[  ERROR   ] spec/db_spec.lua:221: db each_provider_for should list the providing origins for the given package names (81.58 ms)
[ RUN      ] spec/db_spec.lua:239: db each_need_build should list all aports that don't have built apk file
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:249: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:249: in function <spec/db_spec.lua:239>

[  ERROR   ] spec/db_spec.lua:239: db each_need_build should list all aports that don't have built apk file (53.64 ms)
[ RUN      ] spec/db_spec.lua:270: db each_in_build_order should list the specified aports in build order
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:273: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:273: in function <spec/db_spec.lua:270>

[  ERROR   ] spec/db_spec.lua:270: db each_in_build_order should list the specified aports in build order (68.73 ms)
[ RUN      ] spec/db_spec.lua:278: db each_in_build_order should not include other provides when deternmining build order
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:281: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:281: in function <spec/db_spec.lua:278>

[  ERROR   ] spec/db_spec.lua:278: db each_in_build_order should not include other provides when deternmining build order (62.49 ms)
[ RUN      ] spec/db_spec.lua:286: db each_in_build_order should build docs last
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:289: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:289: in function <spec/db_spec.lua:286>

[  ERROR   ] spec/db_spec.lua:286: db each_in_build_order should build docs last (87.01 ms)
[ RUN      ] spec/db_spec.lua:297: db known_deps_exists should return true
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
spec/db_spec.lua:307: attempt to index a nil value (local 'repo1')

stack traceback:
	spec/db_spec.lua:307: in function <spec/db_spec.lua:297>

[  ERROR   ] spec/db_spec.lua:297: db known_deps_exists should return true (69.26 ms)
[----------] 15 tests from spec/db_spec.lua (1526.55 ms total)

[----------] Running tests from spec/pkg_spec.lua
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
Unable to deduce build architecture. Install apk-tools, or set CBUILD.
[ RUN      ] spec/pkg_spec.lua:40: aports.pkg is_remote should return true for remote URLs
[       OK ] spec/pkg_spec.lua:40: aports.pkg is_remote should return true for remote URLs (0.24 ms)
[ RUN      ] spec/pkg_spec.lua:48: aports.pkg should return false for non-remote URLs
[       OK ] spec/pkg_spec.lua:48: aports.pkg should return false for non-remote URLs (0.13 ms)
[ RUN      ] spec/pkg_spec.lua:55: aports.pkg remote_sources should iterate over remote sources
[       OK ] spec/pkg_spec.lua:55: aports.pkg remote_sources should iterate over remote sources (0.16 ms)
[ RUN      ] spec/pkg_spec.lua:74: aports.pkg remote_sources should return nil if source is not a table
[       OK ] spec/pkg_spec.lua:74: aports.pkg remote_sources should return nil if source is not a table (0.09 ms)
[ RUN      ] spec/pkg_spec.lua:86: aports.pkg get_maintainer should return the maintainer
[       OK ] spec/pkg_spec.lua:86: aports.pkg get_maintainer should return the maintainer (4.34 ms)
[ RUN      ] spec/pkg_spec.lua:97: aports.pkg get_repo_name should return the repository name when it exists
[       OK ] spec/pkg_spec.lua:97: aports.pkg get_repo_name should return the repository name when it exists (0.13 ms)
[ RUN      ] spec/pkg_spec.lua:101: aports.pkg get_repo_name should return nil when package directory is not provided
[       OK ] spec/pkg_spec.lua:101: aports.pkg get_repo_name should return nil when package directory is not provided (0.09 ms)
[ RUN      ] spec/pkg_spec.lua:107: aports.pkg get_apk_file_name should return the correct apk file name
[       OK ] spec/pkg_spec.lua:107: aports.pkg get_apk_file_name should return the correct apk file name (0.11 ms)
[ RUN      ] spec/pkg_spec.lua:120: aports.pkg get_apk_file_path should return the correct apk file path
spec/pkg_spec.lua:121: Expected objects to be equal.
Passed in:
(string) '/tmp/lua_HmnaAj/aports/myrepo/myapp/myapp-doc-1.0-r0.apk'
Expected:
(string) '/tmp/lua_HmnaAj/pkgs/myrepo/aarch64/myapp-doc-1.0-r0.apk'

stack traceback:
	spec/pkg_spec.lua:121: in function <spec/pkg_spec.lua:120>

[  FAILED  ] spec/pkg_spec.lua:120: aports.pkg get_apk_file_path should return the correct apk file path (3.74 ms)
[ RUN      ] spec/pkg_spec.lua:134: aports.pkg apk_file_exists should return false when the apk file does not exist
[       OK ] spec/pkg_spec.lua:134: aports.pkg apk_file_exists should return false when the apk file does not exist (0.15 ms)
[ RUN      ] spec/pkg_spec.lua:143: aports.pkg apk_file_exists should return true when the apk file exists
spec/pkg_spec.lua:150: Expected objects to be the same.
Passed in:
(boolean) false
Expected:
(boolean) true

stack traceback:
	spec/pkg_spec.lua:150: in function <spec/pkg_spec.lua:143>

[  FAILED  ] spec/pkg_spec.lua:143: aports.pkg apk_file_exists should return true when the apk file exists (3.82 ms)
[ RUN      ] spec/pkg_spec.lua:168: aports.pkg all_apks_exists should return false when any apk file does not exist
[       OK ] spec/pkg_spec.lua:168: aports.pkg all_apks_exists should return false when any apk file does not exist (0.13 ms)
[ RUN      ] spec/pkg_spec.lua:180: aports.pkg all_apks_exists should return true when all apk files exist
[       OK ] spec/pkg_spec.lua:180: aports.pkg all_apks_exists should return true when all apk files exist (0.10 ms)
[ RUN      ] spec/pkg_spec.lua:190: aports.pkg arch_enabled should return true when arch is enabled for the package
[       OK ] spec/pkg_spec.lua:190: aports.pkg arch_enabled should return true when arch is enabled for the package (0.10 ms)
[ RUN      ] spec/pkg_spec.lua:194: aports.pkg arch_enabled should return true when all arches are enabled for the package
[       OK ] spec/pkg_spec.lua:194: aports.pkg arch_enabled should return true when all arches are enabled for the package (0.08 ms)
[ RUN      ] spec/pkg_spec.lua:198: aports.pkg arch_enabled should return true for noarch packages
[       OK ] spec/pkg_spec.lua:198: aports.pkg arch_enabled should return true for noarch packages (0.06 ms)
[ RUN      ] spec/pkg_spec.lua:202: aports.pkg arch_enabled should return falsy when arch is empty for the package
[       OK ] spec/pkg_spec.lua:202: aports.pkg arch_enabled should return falsy when arch is empty for the package (0.11 ms)
[ RUN      ] spec/pkg_spec.lua:206: aports.pkg arch_enabled should return false when arch is disabled for the package
[       OK ] spec/pkg_spec.lua:206: aports.pkg arch_enabled should return false when arch is disabled for the package (0.07 ms)
[ RUN      ] spec/pkg_spec.lua:210: aports.pkg arch_enabled should return false when arch is disabled for a noarch package
[       OK ] spec/pkg_spec.lua:210: aports.pkg arch_enabled should return false when arch is disabled for a noarch package (3.27 ms)
[ RUN      ] spec/pkg_spec.lua:216: aports.pkg each_dependency should yield dependencies from 'depends' field
[       OK ] spec/pkg_spec.lua:216: aports.pkg each_dependency should yield dependencies from 'depends' field (0.16 ms)
[ RUN      ] spec/pkg_spec.lua:236: aports.pkg each_dependency should yield dependencies from 'makedepends' field
[       OK ] spec/pkg_spec.lua:236: aports.pkg each_dependency should yield dependencies from 'makedepends' field (0.10 ms)
[ RUN      ] spec/pkg_spec.lua:256: aports.pkg each_dependency should yield dependencies from 'checkdepends' field when options['!check'] is falsy
[       OK ] spec/pkg_spec.lua:256: aports.pkg each_dependency should yield dependencies from 'checkdepends' field when options['!check'] is falsy (0.10 ms)
[ RUN      ] spec/pkg_spec.lua:276: aports.pkg each_dependency should not yield dependencies from 'checkdepends' field when options['!check'] is truthy
[       OK ] spec/pkg_spec.lua:276: aports.pkg each_dependency should not yield dependencies from 'checkdepends' field when options['!check'] is truthy (0.09 ms)
[----------] 23 tests from spec/pkg_spec.lua (541.18 ms total)

[----------] Global test environment teardown.
[==========] 44 tests from 3 test files ran. (2543.66 ms total)
[  PASSED  ] 22 tests.
[  FAILED  ] 12 tests, listed below:
[  FAILED  ] spec/abuild_spec.lua:36: abuild get_conf should return the value of a configuration variable from the user config
[  FAILED  ] spec/abuild_spec.lua:49: abuild get_arch should return the CARCH value from user config
[  FAILED  ] spec/abuild_spec.lua:57: abuild get_libc should return the libc value from the user config
[  FAILED  ] spec/abuild_spec.lua:65: abuild abuild.repodest should contain the REPODEST value from the user config
[  FAILED  ] spec/abuild_spec.lua:72: abuild abuild.chost should contain the CHOST value from the user config
[  FAILED  ] spec/db_spec.lua:66: db new should initialize the APK database correctly
[  FAILED  ] spec/db_spec.lua:81: db target_packages should list all target packages
[  FAILED  ] spec/db_spec.lua:96: db recursive_dependencies should list all dependencies in correct order
[  FAILED  ] spec/db_spec.lua:118: db recursive_reverse_dependencies should list all reverse dependencies in correct order
[  FAILED  ] spec/db_spec.lua:137: db each_name should list all apk names and its origin
[  FAILED  ] spec/pkg_spec.lua:120: aports.pkg get_apk_file_path should return the correct apk file path
[  FAILED  ] spec/pkg_spec.lua:143: aports.pkg apk_file_exists should return true when the apk file exists
[  ERROR   ] 10 errors, listed below:
[  ERROR   ] spec/db_spec.lua:155: db each_known_dependency should list all known dependencies
[  ERROR   ] spec/db_spec.lua:169: db each_known_dependency should list a provides as a known dependencies
[  ERROR   ] spec/db_spec.lua:186: db each_aport should list all apk names and its origin
[  ERROR   ] spec/db_spec.lua:203: db each_pkg_with_name should only list the origin(s) for the given package names
[  ERROR   ] spec/db_spec.lua:221: db each_provider_for should list the providing origins for the given package names
[  ERROR   ] spec/db_spec.lua:239: db each_need_build should list all aports that don't have built apk file
[  ERROR   ] spec/db_spec.lua:270: db each_in_build_order should list the specified aports in build order
[  ERROR   ] spec/db_spec.lua:278: db each_in_build_order should not include other provides when deternmining build order
[  ERROR   ] spec/db_spec.lua:286: db each_in_build_order should build docs last
[  ERROR   ] spec/db_spec.lua:297: db known_deps_exists should return true

 12 FAILED TESTS
 10 ERRORS
>>> ERROR: lua-aports: check failed
>>> lua-aports: Uninstalling dependencies...
(1/13) Purging .makedepends-lua-aports (20250523.190733)
(2/13) Purging lua5.4-busted (2.2.0-r0)
(3/13) Purging lua5.4-luassert (1.9.0-r0)
(4/13) Purging lua5.4-mediator (1.1.2-r2)
(5/13) Purging lua5.4-penlight (1.14.0-r0)
(6/13) Purging lua-penlight (1.14.0-r0)
(7/13) Purging lua-filesystem (1.8.0-r4)
(8/13) Purging lua5.4-say (1.4.1-r0)
(9/13) Purging lua5.4-system (0.4.5-r0)
(10/13) Purging lua5.4-term (0.07-r2)
(11/13) Purging lua5.4-posix (36.3-r0)
(12/13) Purging lua5.4-bit32 (5.3.0-r6)
(13/13) Purging lua-cliargs (3.0.2-r0)
Executing busybox-1.37.0-r12.trigger
OK: 564 MiB in 132 packages
